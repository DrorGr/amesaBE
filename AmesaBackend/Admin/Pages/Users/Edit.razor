@page "/admin/users/edit/{UserId:guid}"
@inject IAdminDatabaseService DatabaseService
@inject NavigationManager Navigation

<PageTitle>Edit User - Amesa Admin</PageTitle>

<div class="container-fluid">
    <div class="row mb-4">
        <div class="col">
            <h1 class="display-6">
                <i class="fas fa-user-edit"></i> Edit User
            </h1>
        </div>
    </div>

    @if (user == null)
    {
        <div class="text-center py-5">
            <div class="spinner-border text-primary"></div>
            <p class="mt-3">Loading user...</p>
        </div>
    }
    else
    {
        <div class="card">
            <div class="card-body">
                <EditForm Model="@user" OnValidSubmit="HandleSubmit">
                    <div class="row g-3">
                        <div class="col-md-6">
                            <label class="form-label">Username</label>
                            <InputText class="form-control" @bind-Value="user.Username" />
                        </div>

                        <div class="col-md-6">
                            <label class="form-label">Email</label>
                            <InputText type="email" class="form-control" @bind-Value="user.Email" />
                        </div>

                        <div class="col-md-6">
                            <label class="form-label">First Name</label>
                            <InputText class="form-control" @bind-Value="user.FirstName" />
                        </div>

                        <div class="col-md-6">
                            <label class="form-label">Last Name</label>
                            <InputText class="form-control" @bind-Value="user.LastName" />
                        </div>

                        <div class="col-md-6">
                            <label class="form-label">Phone</label>
                            <InputText class="form-control" @bind-Value="user.Phone" />
                        </div>

                        <div class="col-md-6">
                            <label class="form-label">Status</label>
                            <InputSelect class="form-select" @bind-Value="user.Status">
                                <option value="@UserStatus.Active">Active</option>
                                <option value="@UserStatus.Pending">Pending</option>
                                <option value="@UserStatus.Suspended">Suspended</option>
                                <option value="@UserStatus.Banned">Banned</option>
                            </InputSelect>
                        </div>

                        <div class="col-md-6">
                            <label class="form-label">Verification Status</label>
                            <InputSelect class="form-select" @bind-Value="user.VerificationStatus">
                                <option value="@UserVerificationStatus.Unverified">Unverified</option>
                                <option value="@UserVerificationStatus.EmailVerified">Email Verified</option>
                                <option value="@UserVerificationStatus.PhoneVerified">Phone Verified</option>
                                <option value="@UserVerificationStatus.FullyVerified">Fully Verified</option>
                            </InputSelect>
                        </div>

                        <div class="col-md-6">
                            <div class="form-check mt-4">
                                <InputCheckbox class="form-check-input" @bind-Value="user.EmailVerified" id="emailVerified" />
                                <label class="form-check-label" for="emailVerified">
                                    Email Verified
                                </label>
                            </div>
                            <div class="form-check">
                                <InputCheckbox class="form-check-input" @bind-Value="user.PhoneVerified" id="phoneVerified" />
                                <label class="form-check-label" for="phoneVerified">
                                    Phone Verified
                                </label>
                            </div>
                        </div>
                    </div>

                    <div class="mt-4">
                        <button type="submit" class="btn btn-primary me-2">
                            <i class="fas fa-save"></i> Save Changes
                        </button>
                        <a href="/admin/users" class="btn btn-secondary">
                            <i class="fas fa-times"></i> Cancel
                        </a>
                    </div>
                </EditForm>
            </div>
        </div>
    }
</div>

@code {
    [Parameter]
    public Guid UserId { get; set; }

    private User? user;

    protected override async Task OnInitializedAsync()
    {
        var dbContext = await DatabaseService.GetDbContextAsync();
        user = await dbContext.Users.FindAsync(UserId);
    }

    private async Task HandleSubmit()
    {
        if (user != null)
        {
            var dbContext = await DatabaseService.GetDbContextAsync();
            user.UpdatedAt = DateTime.UtcNow;
            await dbContext.SaveChangesAsync();
            Navigation.NavigateTo("/admin/users");
        }
    }
}

